# 3.4.4. 因子图

> 因子图是进行推理的极好表示。

我们首先介绍因素的概念。再次参考图 3.23 中的示例，让我们考虑后验。由于测量值$$Z$$是已知的，因此后验与六个因子的乘积成正比，其中三个因子来自马尔可夫链，三个是上面定义的似然因子：

$$P(X|Z) \propto P(X_1)L(X_1;z_1)P(X_2|X_1)L(X_2;z_2)P(X_3|X_2)L(X_3;z_3)$$

其中一些因子是一元因子，一些是二元因子，我们的意思是一些因子只依赖于一个隐藏变量，例如\
$$L(X_2;z_2)$$，而另一些因子则依赖于两个变量，例如$$L(X_2;z_2)$$，过渡模型$$P(X_3|X_2)$$。测量在这里不计算在内，因为一旦我们得到了测量$$Z$$，它们就只是作为似然中的已知参数$$L(X_k;z_k)$$起作用，这些参数被视为状态$$X_k$$的函数，即它们将在未知数中产生一元因子。

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption><p>图2 一个 HMM，其中包含三个时间步长的观测测量值，表示为因子图。</p></figcaption></figure>

这激发了一个不同的图形模型，即因子图，在该模型中，我们只表示与编码概率信息的因子相连的隐藏变量$$X_1$$、$$X_2$$和$$X_3$$。对于我们具有三个隐藏状态的示例，相应的因子图如图 4 所示。从图中可以清楚地看出，对于每个因子$$\phi_i$$，因子图的连通性对它所依赖的变量$$X_i$$子集进行编码。我们写道：

$$\phi(X)=\phi_1(X_1)\phi_2(X_1)\phi_3(X_1,X_2)\phi_4(X_2)\phi_5(X_2,X_3)\phi_6(X_3)$$（公式3.28）

其中，上述因素定义为与后验中的六个因素一一对应，例如，

$$\phi_6(X_3)  \approx L(X_3;z_3)$$（公式3.29）

所有测量值都与一元因子相关，而马尔可夫链主要与二元因子相关，但一元因子$$\phi_1(X_1)$$\
除外。请注意，在定义因子时，我们可以省略任何归一化因子，这在许多情况下会导致计算节省。

正式的因子图是具有两种节点的二分图$$F=(U,V,\xi)$$： factors $$\phi_i \in U$$和 variables $$X_{j} \in V$$\
。边$$e_{ij} \in \xi$$始终位于因子节点和变量节点之间，而不是在变量之间或因子之间。与因子$$\phi_i$$\
相邻的随机变量节点集写为$$X_i$$。通过这些定义，因子图F将全局函数$$\phi(X)$$的因式分解定义为

$$\phi(X)=\prod_i \phi_i (X_1)$$（公式3.30）

换句话说，独立关系由因子图的边缘$$e_{ij}$$编码，每个因子$$\phi_i$$仅是其邻接集中变量$$X_i$$的函数。例如，对于图 4 中的因子图，我们有：

$$
\begin{matrix}
X_1=\{X_1\} \\
X_2=\{X_1\} \\
X_3=\{X_1,X_2\} \\
X_4=\{X_2\} \\
X_5=\{X_2,X_3\} \\
X_6=\{X_3\} \\
\end{matrix}
$$
