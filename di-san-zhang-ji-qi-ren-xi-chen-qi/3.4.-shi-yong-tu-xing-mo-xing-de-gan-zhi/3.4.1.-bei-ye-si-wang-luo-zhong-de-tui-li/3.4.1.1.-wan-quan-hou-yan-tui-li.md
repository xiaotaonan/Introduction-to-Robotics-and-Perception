# 3.4.1.1.完全后验推理

> 天真的完全后验推理很容易，但可能很昂贵。

最简单的推理发生在我们可以将变量分为两组时：隐藏变量$$X$$和观测值$$Z$$\
。首先，让我们回顾一下在这种情况下贝叶斯网是什么样子的。从第 3.2 节中，我们知道任何一组变量的一般贝叶斯净值都定义为条件的乘积，如方程 （3.13） 所示。因此，在我们的示例中，我们有：

$$P(X,Z)=\prod_{i=1} P(X_i|\prod_{X_i}) \prod_{j=1} P(Z_j|\prod_{Z_j})$$）（公式3.17）

其中对父集$$\prod$$没有限制，只是有向图是无环的。当然，我们在这里最感兴趣的是前面定义的动态贝叶斯网络，但现在以下内容适用于通用贝叶斯网络。

主力不推理是贝叶斯定理，我们在上一章的感知部分 2.4 节中遇到了它。让我们定义为$$\xi$$中所有变量的观测值集$$Z$$。然后，给定$$\xi$$&#x20;observed 值$$Z$$的值，我们有兴趣计算 后验概率分布$$P(X|Z=\xi)$$。为了计算这一点，我们应用贝叶斯定理，但现在应用于变量集，以获得隐藏变量$$X$$的后验表达式。使用 2.4 节中贝叶斯定理的 “easy” 版本，我们只是将后验重写为关节，但实例化所有变量$$\xi Z$$的值：

$$P(X|Z=\xi) \propto P(X,Z = \xi )$$（公式3.18）

这看起来太简单了，但它确实有效，如图 3.21 中的一个小的通用贝叶斯网示例所示。让我们回顾一下变量X、Y、W和Z的 4 变量贝叶斯网示例，让我们以$$X=(X,Y)$$和$$Z=(W,Z)$$为例，我们在图中通过渲染W和Z框来表示。

```python
#| caption: Bayes net for the 4-variable model, again.
#| label: fig:bayesnet_4
show(wxyz, boxes={Z1[0], W1[0]})
```

<figure><img src="../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

上面应用的贝叶斯定理提出了一种简单的算法来计算上面的后验分布：只需枚举表$$Z$$中的所有元组，对每个元组进行评估$$P(X,Z=\xi)$$，然后进行归一化。请注意，我们只需要枚举$$X$$中的变量，因为 $$Z$$中的所有变量都是固定的。

将此应用于我们的示例需要评估 100 个概率，如果我们像以前一样假设每个变量可以产生 10 种不同的结果。我们显示了以下情况的结果表$$\xi=(2,7)$$，即表中的每个条目都是$$P(X,Y|W=2,Z=7) \propto P(W=2,X,Y,Z=7)$$ 的值\
。下面我们显示 factorizedjoint 概率，以说明一点：

|      x     |      y     | P(W=2, X=x, Y=y, Z=7)  P（W=2， X=x， Y=y， Z=7）                                                                                      |
| :--------: | :--------: | --------------------------------------------------------------------------------------------------------------------------------- |
|      1     |      1     | <p><em>P(W=2|X=1, Z=7)P(X=1|Y=1, Z=7)P(Y=1|Z=7)P(Z=7)</em><br><em>P（W=2|X=1， Z=7）P（X=1|Y=1， Z=7）P（Y=1|Z=7）P（Z=7）</em></p>         |
|      1     |      2     | <p><em>P(W=2|X=1, Z=7)P(X=1|Y=2, Z=7)P(Y=2|Z=7)P(Z=7)</em><br><em>P（W=2|X=1， Z=7）P（X=1|Y=2， Z=7）P（Y=2|Z=7）P（Z=7）</em></p>         |
| $$\vdots$$ | $$\vdots$$ | $$\vdots$$                                                                                                                        |
|     10     |      9     | <p><em>P(W=2|X=10, Z=7)P(X=10|Y=9, Z=7)P(Y=9|Z=7)P(Z=7)</em><br><em>P（W=2|X=10， Z=7）P（X=10|Y=9， Z=7）P（Y=9|Z=7）P（Z=7）</em></p>     |
|     10     |     10     | <p><em>P(W=2|X=10, Z=7)P(X=10|Y=10, Z=7)P(Y=10|Z=7)P(Z=7)</em><br><em>P（W=2|X=10， Z=7）P（X=10|Y=10， Z=7）P（Y=10|Z=7）P（Z=7）</em></p> |

我们通过对所有这些条目求和来计算$$\sum_{x,y} P(W=2,X=x,Y=y,Z=7)$$\
，然后将所有条目除以总和来进行归一化。

显然，使用这种方法估计整个后验效率不高。在此示例中，该表包含 100 个条目，通常条目数的大小为$$X$$指数级。但是，在检查表中的条目时，已经有一些明显的保存方法：例如，$$P(Z=7)$$是所有条目中的公共因子，因此显然我们不需要费心将其相乘。下面我们将讨论充分利用贝叶斯网络结构进行有效推理的方法。
