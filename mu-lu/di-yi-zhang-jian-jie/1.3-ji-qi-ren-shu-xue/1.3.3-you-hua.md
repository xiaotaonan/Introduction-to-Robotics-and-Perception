# 1.3.3 优化

> 如果你能拥有最好的，为什么还要将就呢？

机器人技术中的许多计算问题要么难以解决（即计算复杂度高），要么无法以封闭形式求解（例如，确定概率分布的确切形式）。在这两种情况下，机器人专家都致力于开发高效、准确的计算方法来解决这些问题。本书主要介绍两种计算方法：基于采样的方法（我们上文讨论过）和优化方法。

优化是寻找性能指标极值的过程，本书中，所有这些指标都将表示为有限个输入的标量值函数。在某些情况下，我们会寻找能够最小化成本函数的单个标量输入，例如，在第 2 章中为垃圾分类机器人选择最佳动作时。在其他情况下，我们可能会寻找能够产生理想系统轨迹的一系列输入命令，例如，在第 7 章中无人机的飞行轨迹。我们通常会使用因子图来表示问题空间和目标函数（定义如下）。我们将使用开源库 GTSAM，这是一个强大的软件系统，可以为各种可以用因子图描述的优化问题提供计算效率高的解决方案。在其他情况下，我们可能会尝试为神经网络找到数百万个权重，以最小化计算机视觉系统的识别误差，例如第 5 章中的卷积神经网络（CNN）。

一般来说，我们可以将此类问题表述为:

$$\mathop{max}\limits_{x}f(x)$$ (公式) 1.6

其中$$x$$称为优化变量（如果$$x$$为向量，则称为变量），$$f(\cdot)$$称为目标函数。对于此公式，在最大化时，$$f(\cdot)$$可视为奖励。我们也可以将此问题表述为最小化问题，$$min_x f(x)$$，在这种情况下，$$f(\cdot)$$应视为需要最小化的成本。这两种形式之间的转换很容易（例如，只需将目标函数乘以$$-1$$），但根据问题的语义，将问题具体表述为最小化成本或最大化奖励通常会有所帮助。

许多优化问题可以用梯度下降法来解决。这类方法构建一个估计序列，$$x^1,x^2,...$$，直到找到最小成本值。估计值的增量更新规则如下:

$$x^{k+1} = x^k-\alpha\nabla f(x)$$ (公式1.7)

其中$$\alpha$$是步长参数。在某些情况下，梯度$$\nabla f(x)$$可以以封闭形式计算，而对于更复杂的函数，可能需要使用梯度的数值近似值。

当使用神经网络时，成本函数可以写成:

$$f(x,S)=\sum_{s \in S}f_k(x;s)$$ (公式 1.8)

其中$$x$$表示分配给网络中连接的权重，$$s$$表示数据集$$S$$中的一个具体示例。由于微分是线性的，因此该函数的梯度可以表示为:

$$\nabla_x f(x,S)=\sum_{s \in S} \nabla_x f_k(x;s)$$ (公式 1.9)

如果数据集非常大，计算$$|S|$$梯度将会非常困难。随机梯度下降 (SGD) 方法可以解决这个问题，它从数据集$$S^{'}\subset S$$中随机选择一些样本，并使用近似值:

$$\nabla_x f(x,S) \approx \sum_{s \in S^{'}} \nabla_x f_k(x;s)$$ (公式 1.10)

我们在第 5 章中使用随机梯度下降来优化深度神经网络中的权重。

另一方面，离散时间优化问题使用因子图可以更自然地解决。在机器人技术中，优化变量通常可以写成$$x_1,x_2,...x_n$$，其中下标表示时间上的离散时刻。在这种情况下，每个$$x_k$$和$$x_{k+1}$$之间通常都有明确的关系。例如，当机器人在世界中移动时，每一步$$k$$都会执行命令$$u_k$$并收集数据$$z_k$$。估计状态轨迹$$x_1,...,x_n$$可以表述为一个优化问题，其中$$u_k$$的值充当$$x_k$$和$$x_{k+1}$$之间关系的一种约束，正如我们将在第 4 章解决定位问题时看到的那样。类似地，如果我们希望优化无人机的轨迹（如第 7 章所述），优化问题首先要找到一系列状态$$x_1,...,x_n$$，以最大化性能标准。在这种情况下，为了确保平稳飞行，$$x_k$$和$$x_{k+1}$$之间的距离不应太远。对于此类问题，当优化变量之间存在特定关系时，特别是当它们具有这种顺序结构时，我们可以使用因子图来解决优化问题，当编码变量相互依赖性的图稀疏时，这在计算上是有效的。

在本书中，我们将在许多不同场合使用（随机）梯度下降和基于因子图的优化。

\
