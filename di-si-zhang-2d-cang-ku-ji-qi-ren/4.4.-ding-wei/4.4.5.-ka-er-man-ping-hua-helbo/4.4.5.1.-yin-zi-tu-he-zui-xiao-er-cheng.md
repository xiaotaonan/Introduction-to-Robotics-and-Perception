# 4.4.5.1. 因子图和最小二乘

> 当给定测量和动作时，我们可以直接创建一个因子图。

卡尔曼平滑是隐马尔可夫模型中与维特比算法等效的方法，但适用于连续状态空间。

在连续情况下，我们直接根据给定的控制输入和测量构建因子。因子图现在编码了负对数后验

$$
\begin{equation}
\Phi(X)=\sum_i \phi(X_i) = \frac{1}{2} \sum_i \|A_i X_i-b_i\|^2.
\end{equation}
$$

在连续情况下，我们使用对数似然的极小化而不是概率的极大化。主要原因是推理变成了线性最小二乘问题。

最小二乘问题是凸的，可以用封闭形式求解。上式平方范数中的线性项在某种意义上是稀疏的，因为$$X_i$$只是连续变量$$X$$的一个子集。例如，在两个标量变量$$x_1$$和$$x_2$$上的一个简单传感器融合问题，会是它们各自具有简单先验，分别对应$$\mu_1=3$$和$$\mu_2=7$$，并且我们知道它们之间的差等于$$5$$。这会产生三个需要在$$x_1$$和$$x_2$$上最小化的因子：

$$\begin{equation} \Phi(X)= \frac{1}{2} |x_1-3|^2 + \frac{1}{2} |(x_2-x_1)-5|^2 + \frac{1}{2} |x_2-7|^2. \end{equation}$$

$$
\begin{equation}
\Phi(X)= \frac{1}{2} \|x_1-3\|^2 + \frac{1}{2} \|(x_2-x_1)-5\|^2 + \frac{1}{2} \|x_2-7\|^2.
\end{equation}
$$

这对应于以下

|     X\_i    |    A\_i   | b\_i |
| :---------: | :-------: | :--: |
|   $$x_1$$   |   \\\[1]  |   3  |
| $$x_1,x_2$$ | \\\[-1 1] |   5  |
|   $$x_2$$   |   \\\[1]  |   7  |

我们可以将所有三个矩阵$$A_1$$、$$A_2$$和$$A_3$$$$A_$$合并成一个稀疏矩阵$$A$$以及对应的右侧矩阵b\
：

$$
\begin{equation}
A=\begin{pmatrix} 1 & 0 \\ -1 & 1 \\ 0 & 1 \end{pmatrix}~~\text{and}~~B=\begin{pmatrix} 3 \\ 5 \\ 7 \end{pmatrix}.
\end{equation}
$$

你可以让自己相信，那么最小化问题可以写成:

$$
\begin{equation}
X^* = \arg \min_X \Phi(X) = \arg \min_X \frac{1}{2} \|A X-b\|^2
\end{equation}
$$

这现在是一个稀疏的线性最小二乘问题。

将导数设为零并求解$$X^*$$，我们得到：

$$
\begin{aligned} A^T(A X^* - b) &= 0 \ (A^T A) X^* &= A^T b \ X^* &= (A^T A)^{-1} A^T b \end{aligned}
$$

这被称为正规方程组，上述最后一个方程是它的封闭形式解。

通过这种方式解决线性最小二乘问题可能很昂贵。矩阵$$A$$可能具有非常高的维度，但幸运的是，在许多传感器融合场景中，它非常稀疏。尽管如此，我们仍需谨慎进行，因为一般来说，矩阵$$(A^T A)^{-1}$$并不稀疏。矩阵$$Q \doteq A^T A$$被称为 Hessian 矩阵或信息矩阵，如果存在n个标量未知数，它的维度为$$n\times n$$。通常，计算它需要$$O(n^3)$$的工作量，对于$$n=3$$来说只有 27，但对于$$n=100$$已经达到 10 亿。\
