# 4.4.2. 贝叶斯滤波器

> 贝叶斯滤波器是一种迭代的一步求和积算法。

贝叶斯滤波器根据当前时间（在我们的离散时间表示中用索引$$k$$表示）的所有测量值和动作历史（直到当前时间）来估计机器人的状态。为了简化符号，我们定义$$\mathcal{Z}^{k}={z_{1},z_{2},\ldots z_{k}}$$，即直到阶段$$k$$的所有测量值。类似地，我们定义控制量$$\mathcal{U}^{k}={u_{1},u_{2},\ldots u_{k-1}}$$。请注意，控制变量的数量总是比测量值的数量少一个。贝叶斯滤波器计算条件概率分布$$P(X_k | \mathcal{Z}^{k},\mathcal{U}^{k})$$，这也被称为滤波分布。

假设我们已知机器人初始状态$$P(X_1)$$的先验分布，我们可以使用传感器观测值$$z_1$$来初始化贝叶斯滤波器，用于时间$$k=1$$。请注意，尚未应用任何动作。因此，我们有:

$$
\begin{equation}
P(X_1|\mathcal{Z}^1=\{z_1\}, \mathcal{U}^1=\{\}) \propto L(X_1;z_1)P(X_1)
\end{equation}
$$

基于这一点，递归地假设我们有一个关于先前状态$$X_{k-1}$$的概率分布$$P(X_{k-1}|\mathcal{Z}^{k-1},\mathcal{U}^{k-1})$$，我们分两个阶段进行：

* 在预测阶段，我们根据控制$$u_{k-1}$$  计算当前状态$$X_k$$  上的预测分布$$P(X_{k}|\mathcal{Z}^{k-1},\mathcal{U}^{k})$$  \
  。这是通过边缘化出先前状态$$X_{k-1}$$  ，通过对所有可能的$$X_{k-1}$$  值$$x_{k-1}$$  求和来完成的：$$P(X_{k}|\mathcal{Z}^{k-1},\mathcal{U}^{k})=\sum_{x_{k-1}}P(X_{k}|x_{k-1},u_{k-1})P(x_{k-1}|\mathcal{Z}^{k-1},\mathcal{U}^{k-1}).$$
* 在测量阶段，我们通过贝叶斯定理将预测密度升级为滤波分布$$P(X_{k}|\mathcal{Z}^{k},\mathcal{U}^{k})$$，给定测量$$P(X_{k}| \mathcal{Z}^{k},\mathcal{U}^{k})   \propto L(X_{k};z_{k})P(X_{k}|\mathcal{Z}^{k-1},\mathcal{U}^{k}).$$

敏锐的观察者会注意到上述步骤 1 和步骤 2 实现了 3.4 节中和积算法的一步，在此情况下消除了先前状态$$X_{k-1}$$。步骤 1 是求和，步骤 2 是乘积。此外，请注意，虽然在本章中我们引入了连续状态，但上述内容仍使用求和（$$\sum$$）而非积分（$$\int$$）来表述。当我们讨论卡尔曼滤波器时，我们将切换到连续积分。
